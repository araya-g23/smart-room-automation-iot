<!DOCTYPE html>
<html lang="en">
  <head>
    <link
      rel="icon"
      href="{{ url_for('static', filename='images/favicon.png') }}"
    />
    <link
      rel="apple-touch-icon"
      href="{{ url_for('static', filename='images/favicon.png') }}"
    />

    <meta charset="UTF-8" />
    <title>{% block title %}Smart Room{% endblock %}</title>

    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/main.css') }}"
    />
  </head>
  <script>
    // Auto-hide flash messages after 4 seconds
    setTimeout(() => {
      const flashes = document.querySelectorAll(".eg_flash");
      flashes.forEach((flash) => {
        flash.style.opacity = "0";
        flash.style.transform = "translateY(-6px)";
        setTimeout(() => flash.remove(), 300);
      });
    }, 4000);

    function eg_closeFlash(button) {
      const flash = button.parentElement;
      flash.style.opacity = "0";
      flash.style.transform = "translateY(-6px)";
      setTimeout(() => flash.remove(), 300);
    }
  </script>

  <body>
    <div class="eg_appLayout">
      <!-- Sidebar -->
      <aside class="eg_sidebar" id="eg_sidebar">
        <div class="eg_sidebarHeader">
          <img
            src="{{ url_for('static', filename='images/logo.png') }}"
            alt="Smart Room Logo"
            class="eg_logoImage"
          />
        </div>

        <div class="eg_sidebarHeaderDivider"></div>

        <nav class="eg_sidebarNav">
          <a href="{{ url_for('dashboard') }}" class="eg_navItem">Dashboard</a>
          <a href="{{ url_for('settings') }}" class="eg_navItem">Settings</a>

          {% if current_user.is_authenticated and current_user.role == "admin"
          %}
          <div class="eg_divider"></div>

          <a href="{{ url_for('admin_audit_logs') }}" class="eg_navItem">
            Audit Logs
          </a>
          <a href="{{ url_for('admin_sensor_logs') }}" class="eg_navItem">
            Sensor Logs
          </a>

          {% if current_user.role == "admin" %}
          <a href="{{ url_for('admin_users') }}" class="eg_navItem">Users</a>
          {% endif %}

          <!-- <a href="#" class="eg_navItem"> Subscriptions </a> -->
          {% endif %}

          <div class="eg_divider"></div>

          <a href="{{ url_for('logout') }}" class="eg_navItem eg_logout">
            Logout
          </a>
        </nav>
      </aside>

      <!-- MOBILE OVERLAY -->
      <div
        class="eg_sidebarOverlay"
        id="eg_sidebarOverlay"
        onclick="eg_toggleSidebar()"
      ></div>

      <div class="eg_mainArea">
        <header class="eg_topbar">
          <div class="eg_topbarLeft">
            <button class="eg_menuBtn" onclick="eg_toggleSidebar()">☰</button>
            <!-- <span class="eg_topbarBrand">Smart Room</span> -->
          </div>

          {% if current_user.is_authenticated %}
          <div class="eg_topbarRight">
            <span class="eg_userEmail">{{ current_user.email }}</span>
          </div>
          {% endif %}
        </header>

        <!-- FLASH MESSAGES -->
        {% with messages = get_flashed_messages(with_categories=true) %} {% if
        messages %}
        <div class="eg_flashContainer" id="eg_flashContainer">
          {% for category, message in messages %}
          <div class="eg_flash eg_flash{{ category|capitalize }}">
            <span>{{ message }}</span>
            <button
              type="button"
              class="eg_flashClose"
              onclick="eg_closeFlash(this)"
            >
              ×
            </button>
          </div>
          {% endfor %}
        </div>
        {% endif %} {% endwith %}

        <main class="eg_content">{% block content %}{% endblock %}</main>
      </div>
    </div>

    <script>
      function eg_toggleSidebar() {
        document
          .getElementById("eg_sidebar")
          .classList.toggle("eg_sidebarOpen");

        document
          .getElementById("eg_sidebarOverlay")
          .classList.toggle("eg_overlayOpen");
      }
    </script>
  </body>
</html>
